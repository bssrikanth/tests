#
# Server-OS Avocado Boot Test Configuration File
#
# Usage: avocado run --vt-config boot-qemu.cfg
#
# EDIT: To point to the local Avocado base_data dir
include tests-shared.cfg
# Required Global Configurations
only (image_backend=filesystem)
only no_9p_export
only no_virtio_rng
only smallpages
only default_bios
only bridge
only smp2
only qcow2
only no_pci_assignable
no multi_host
no ide,xenblk,lsi_scsi,ahci,sd
no qed,qcow2v3,raw_dd,vmdk, usb2
no e1000-82540em,e1000-82545em,e1000-82544gc,xennet,nic_custom
auto_cpu_model = "yes"
#cpu_model = "EPYC-v4"
#cpu_model = "host"
no i440fx
kill_vm = yes
enable_kvm =yes
avocado_vt_repo="https://github.com/bssrikanth/avocado-vt.git"
avocado_vt_repo_branch="nested_images"
test_timeout=24400
avocado_guest_reinstall=yes
start_vm = yes
kill_vm = yes
usb_controller = xhci
usb_type = qemu-xhci
usb_type_usb1 = qemu-xhci
restore_image_after_testing=yes
extra_params="-machine memory-encryption=sev0  -object sev-guest,id=sev0,policy=0x5,cbitpos=51,reduced-phys-bits=1"
# --- Platform ---
only q35
# --- Block devices ---
# --- Net devices ---
only virtio_net
# --- Misc ---
shutdown_method = shell
guest_dmesg_level = 2
shell_client=ssh
virtio_dev_iommu_platform=on
virtio_dev_disable_legacy=on
bridge=virbr0
nic_mode=tap
backup_image_before_test=yes
restore_image_after_test=yes
main_vm = vm1
vms = vm1

#Test
variants:
    - qemu_sanity:
       variants:
            - shutdown:
                only io-github-autotest-qemu.shutdown
variants:
    - virtioblk:
       only virtio_blk
       no virtio_scsi
       kernel_params='root=/dev/vda rw console=ttyS0 net.ifnames=0 biosdevname=0 movable_node'
    - virtioscsi:
       only virtio_scsi
       no virtio_blk
       kernel_params='root=/dev/sda rw console=ttyS0 net.ifnames=0 biosdevname=0 movable_node'
variants:
    - max_config:
       mem = 180000
       smp = 256
       vcpu_cores = 128
       vcpu_threads = 2
       vcpu_sockets = 1
    - min_config:
       mem = 24000
       smp = 1
       vcpu_cores = 1
       vcpu_threads = 1
       vcpu_sockets = 1
